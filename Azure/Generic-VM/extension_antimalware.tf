resource "azurerm_virtual_machine_extension" "vm_antimalware" {
  name = "IaaSAntimalware"
  count = var.enable_anti_malware_extension ? 1 : 0
  depends_on = [azurerm_virtual_machine.vm_virtualmachine]
  virtual_machine_id   = azurerm_virtual_machine.vm_virtualmachine.id
  publisher            = "Microsoft.Azure.Security"
  type                 = "IaaSAntimalware"
  type_handler_version = "1.5"
  settings = <<SETTINGS
    { "AntimalwareEnabled": true,
    "RealtimeProtectionEnabled": true,
    "ScheduledScanSettings": {
        "isEnabled": true,
        "day": "1",
        "time": "120",
        "scanType": "Full" },
        "Exclusions": {
            "Extensions": ".mdf;.ldf",
            "Paths": "c:\\windows;c:\\windows\\system32",
            "Processes": "taskmgr.exe;notepad.exe" }
            }
SETTINGS
}